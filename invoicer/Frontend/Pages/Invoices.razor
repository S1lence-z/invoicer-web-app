@page "/invoices";
@using Domain.Models
@using Domain.ServiceInterfaces
@using Frontend.Components;
@inject IInvoiceService invoiceService;

@* PAGE CONTAINER *@
<div class="d-flex flex-column border rounded-3">
    @* HEADER *@
    <div class="d-flex flex-row justify-content-between align-content-center px-4 pt-4">
        <h3>Invoices</h3>
        <button class="btn btn-primary">
            Add New Invoice
        </button>
    </div>
    <hr/>
    @* CONTENT *@
    <div class="d-flex flex-column px-4 pb-4 gap-2">
        @* FILTER AND SEARCH BAR *@
        <div class="d-flex flex-column border border-black flex-grow-1 rounded">
            <div class="d-flex flex-row justify-content-between align-items-center p-2">
                <input type="text" class="form-control" placeholder="Search..." />
                <button class="btn btn-primary">
                    Search
                </button>
            </div>
            <div class="d-flex flex-row justify-content-between align-items-center p-2">
                <label for="filter">Filter by:</label>
                <select class="form-select" id="filter">
                    <option value="all">All</option>
                    <option value="paid">Paid</option>
                    <option value="unpaid">Unpaid</option>
                </select>
            </div>
        </div>
        @* DETAILS OF THE SELECTED ENTITY *@
        @if (allInvoices is null) {
            <p>Loading...</p>
        } else if (allInvoices.Count == 0) {
            <p>No invoices found</p>
        } else {
            @* LIST HEADER *@
            <div class="d-flex flex-row border rounded p-2 align-items-center mt-4">
                <div class="d-flex flex-row gap-4 align-items-center" style="cursor: pointer;">
                    <p class="align-content-center text-center">Invoice Number</p>
                    <p class="text-center">Buyer</p>
                    <p class="text-center">Seller</p>
                    <p class="text-center">Due Date</p>
                    <div class="d-flex flex-row gap-1">
                        <p class="text-center">Total</p>
                        <p class="text-center">Currency</p>
                    </div>
                </div>
            </div>
            @* INVOICES LIST *@
            <div class="d-flex flex-column overflow-auto gap-2" style="max-height: 600px">
                @foreach (var invoice in allInvoices)
                {
                    <InvoiceListItem Invoice="invoice" />
                }
            </div>
        }
        @* *@
    </div>
</div>

@code {
    private IList<Invoice> allInvoices = new List<Invoice>();
    private Invoice? selectedInvoice = null;

    protected override async Task OnInitializedAsync() {
        await LoadInvoices();
    }

    private async Task LoadInvoices() {
        try {
            allInvoices = (await invoiceService.GetAllAsync()).ToList();
        } catch (Exception ex) {
            Console.WriteLine(ex.Message);
        }
    }
}